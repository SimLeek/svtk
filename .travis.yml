language: python
dist: xenial
sudo: true

stages:
  - lint
  - install
  - script
  - deploy

cache: pip
python:
  - '3.6'
  - '3.7'

jobs:
  include:
    - stage: lint
      install:
        - pip install pre-commit
        - pre-commit install-hooks
      script:
        - pre-commit run --all-files

    - stage: install
      install:
        - pip install --upgrade pip
        - pip install poetry
    - stage: script
      script:
        - poetry config http-basic.pypi $PYPI_USER $PYPI_PASS
        - poetry build

    - stage: deploy
      provider: script
      script: poetry publish
      skip_existing: true
      skip_cleanup: true